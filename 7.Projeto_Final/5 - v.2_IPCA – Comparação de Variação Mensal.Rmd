---
title: "Dinâmica do IPCA: Comparação do Acumulado no Ano e Variação Mensal da inflação" 
author: "Sérgio Ricardo Vieira Torres Silva"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: flatly
    highlight: tango
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE
  
)
```
# 1.Introdução
Este relatório compara a variação mensal (Gráfico II) do IPCA e o valor acumulado (Gráfico I) entre os anos selecionados, utilizando uma base construída a partir de uma API do SIDRA para baixar a planilha, pretendendo mostrar as minhas habilidades em ETL ao professor. Sim, sei que poderia manipular a base inteira a partir da API construída sem me preocupar em exportar a planilha, utilizando a biblioteca "writexl".

# 2.Definindo diretório do arquvio
```{r}
getwd()
setwd("E:/ufal/scripts")

```

# 3.Carregando as bibliotecas
```{r}
library(sidrar)
library(writexl)
library(readr)
library(dplyr)
library(lubridate)
library(stringr)
library(tsibble)
library(ggplot2)
```

# 4.Construindo uma API
Para a construção de uma API Sidra, entrei no site https://apisidra.ibge.gov.br/. Em seguida, segundo a tabela fornecida, utilizei o código "1737" para assim usar os parâmetros utilizados no script abaixo. 

Confira os parâmetros utilizados: https://apisidra.ibge.gov.br/desctabapi.aspx?c=1737.

```{r}
ipca_brasil <- get_sidra(
  api = "/t/1737/n1/1/v/69/p/all"
)
```

# 5.Exportando a planilha a partir da API construida
```{r}
write.table(ipca_brasil, 
            file = "inflacao_ipca_var_mensal_brasil10.csv",
            sep = ",",
            row.names = FALSE, 
            fileEncoding = "UTF-8")

```


# 6.Importar dados
```{r}
df <- read_csv("inflacao_ipca_var_mensal_brasil10.csv")
```


# 7.limpeza e preparação da coluna de datas
```{r}
col_mes <- "Mês (Código)"

df_clean <- df %>%
mutate(
bruto = as.character(`Mês (Código)`),
Data = ym(bruto),
Ano  = year(Data),
Mes  = month(Data, label = TRUE, abbr = TRUE)
) %>%
filter(!is.na(Data))
```


# 8.Criar tsibble 
```{r}
ts_ipca <- df_clean %>%
as_tsibble(index = Data)
```

# 9.Selecionar anos específicos
```{r}
ts_ipca_filtrado_ano_acumulado <- ts_ipca %>%
filter(Ano %in% c(2021, 2025))
```

# 10.Gráfico: IPCA acumulado no ano
```{r}
ggplot(ts_ipca_filtrado_ano_acumulado, aes(x = Mes, y = Valor, group = Ano)) +
geom_line(color = "steelblue", linewidth = 1) +
geom_point(size = 1.4) +

# Adicionar percentual no gráfico
geom_text(
aes(label = sprintf("%.2f%%", Valor)),
vjust = -0.5,
size = 3.2
) +

facet_wrap(~ Ano, scales = "free_y") +
labs(
title = "IPCA – Acumulado no Ano",
subtitle = "Comparação entre anos selecionados",
x = "Mês",
y = "Variação Mensal (%)"
) +
theme_minimal(base_size = 10) +
theme(
strip.text = element_text(size = 12, face = "bold"),
plot.title = element_text(size = 16, face = "bold"),
plot.subtitle = element_text(size = 16),
axis.text = element_text(size = 9),
axis.title = element_text(size = 9)
)
```

# 11 Conclusão (IPCA - Acumulado no Ano)

O IPCA (Índice Nacional de Preços ao Consumidor Amplo) é o indicador oficial de inflação do Brasil. Portanto, mede a variação média dos preços de um conjunto de bens e serviços consumidos pelas famílias brasileiras. ele mostra quanto os preços subiram ou caíram de um mês para outro.

identificando a inflação e deflação:

- IPCA > 0 -> Inflação
- IPCA < 0 -> Deflação
- IPCA ≈ 0 -> Estabilidade

Portanto, sempre que o ponto no gráfico estiver acima de 0%, há inflação. Por outro lado, quando estiver abaixo, é deflação, aí quando estiver tendendo a 0%, a inflação está estável.

Dessa forma, de acordo com a classificação acima, temos que, no ano de 2025 (ano atual em que estou construindo este projeto), a inflação acumulada no ano, comparada ao ano de 2021 (época da pandemia), permite notar o quanto os valores de alguns bens inflaram mês a mês em relação ao ano de 2025.

Fonte: https://www.ibge.gov.br/explica/inflacao.php

## 12.Transformação da série acumulada por ano em uma série mensal
```{r}
ts_ipca_mes <- ts_ipca %>%
  group_by(Ano) %>%
  mutate(Valor_Mensal = Valor - lag(Valor, default = 0)) %>%
  ungroup()

```


## 13.Gráfico: IPCA Variação Mensal
```{r}

#Selecionar anos específicos com o intuito observar a variação da inflação por mês
ts_ipca_filtrado <- ts_ipca_mes %>%
  filter(Ano %in% c(2021,2025))

ggplot(ts_ipca_filtrado, aes(x = Mes, y = Valor_Mensal, group = Ano)) +
  geom_line(color = "steelblue", linewidth = 1) +
  geom_point(size = 1.4) +
  
  # Adicionar percentual no gráfico
  geom_text(
    aes(label = sprintf("%.2f%%", Valor_Mensal)),
    vjust = -0.5,
    size = 3.2
  ) +
  facet_wrap(~ Ano, scales = "free_y") +
  labs(
    title = "IPCA – Variação Mensal",
    subtitle = "Comparação entre anos selecionados",
    x = "Mês",
    y = "Variação Mensal (%)"
  ) +
  theme_minimal(base_size = 10) +
  theme(
strip.text = element_text(size = 12, face = "bold"),
plot.title = element_text(size = 16, face = "bold"),
plot.subtitle = element_text(size = 16),
axis.text = element_text(size = 9),
axis.title = element_text(size = 9)
)
```

## 14.Conclusão (IPCA - Variação mensal da inflação)

O IPCA (Índice Nacional de Preços ao Consumidor Amplo) é o indicador oficial de inflação do Brasil. Portanto, mede a variação média dos preços de um conjunto de bens e serviços consumidos pelas famílias brasileiras. ele mostra quanto os preços subiram ou caíram de um mês para outro.


identificando a inflação e deflação:

- IPCA > 0 -> Inflação
- IPCA < 0 -> Deflação
- IPCA ≈ 0 -> Estabilidade

Portanto, sempre que o ponto no gráfico estiver acima de 0%, há inflação. Por outro lado, quando estiver abaixo, é deflação, aí quando estiver tendendo a 0%, a inflação está estável.

Dessa forma, de acordo com a classificação acima, temos que, no ano de 2021 (época da pandemia), todos os meses tiveram inflação. Além disso, em setembro (1,23%), outubro (1,34%) e novembro (1,02%) de 2021, houve inflação forte, ou seja, alguns bens das familias brasileiras ficaram muito caro. Por outro lado, no ano de 2025, apenas em fevereiro (1,31%) houve inflação forte; em agosto (-0,11%) houve deflação e, como em outubro (0,09%), houve a estabilidade da inflação.

Fonte: https://www.ibge.gov.br/indicadores#ipca





